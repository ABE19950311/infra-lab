* オンプレミスからaws環境nagiosサーバへのルート設計と構築
  オンプレミスA⇔VPN⇔オンプレミスB⇔DirectConnect⇔AWS
  AWS環境の設定変更(セキュリティグループ、ネットワークACL)はterraformを使用
　一通りルート設計後にpingが通らない。aws nagiosサーバでtcpdumpをした結果、パケットは届いていて返している事は分かった。
　結果として、transitgatewayにオンプレミスAへの戻りルートを静的に作成した結果、
　customerルータにawsへのルートとして伝播していたことで、戻れていなかった
　対応方法として、オンプレミスAでNATをしてオンプレミスBのIPにして既存ルートで戻れるようにするか、customerルータにオンプレミスAへのルートを追加してもらうよう依頼をするかの２択となった。
　customerルータにルート追加いただいて、transitgatewayにもルートが伝播したことで、疎通するようになった。


* cloudfrontへのコンテンツ移行と構築、構成図作成
静的コンテンツはcloudfront+s3+acm
動的コンテンツ（メール送信）は、cloudfront+lambda+ses
構築はterraformを使用

・障害ドリルの作成（aws環境）
障害ドリルとは？
→本サービス展開前に、意図的にサーバをダウンさせて、フェールオーバーするか
 手順通り復旧できるか、確認と手順作成をする
片系ダウン -> アラートが飛んで、フェールオーバーしてサービス継続されるか
両系ダウン -> アラートが飛んで、手順通り復旧できるか
何をトリガーに何のアラートが誰宛てに飛ぶ？
飛んだアラートは誰がキャッチして、何のアクションを起こす？
アクションの結果、正常に復旧できたか？

* AWSリソース（EFS,FSx）への監視項目検討、設定とドキュメント作成
監視はcloudWatchアラーム

* CentOSからalmalinuxへのOS移行
kvmでの検証とテスト実施後、作業手順を作成して本番(ec2)で実施
webサーバ(nginx,php-fpm),apサーバ(rails,docker),dbサーバ(redis,mariadb)
移行時に発生したミドルウェアのバージョンアップに伴い、phpが動かない等の問題も発生

* dosポリシー、ratelimit設定、チューニング作業
FWはforigate-1000D

* 他細かいこと
SSL証明書更新
ansibleを使用したサーバ設定変更
内部DNSサーバへのレコードとゾーン追加
nagios監視設定追加
FWポリシー設定追加
vmware上のサーバ複製と設定、監視追加、lb追加

* nagios監視設定修正等
Notionタスク：nfs-partnerlog/LOAD閾値の変更 の件で、今の監視設定と過去の発砲状況を調べました。
・今の監視設定
define service{
        use                             gen-service
        host_name                       nfs-partnerlog
        service_description             LOAD
        check_command                   check_nrpe_load!20,40,80!30,60,90
        }
・ PROBLEM Service Alert: nfs-partnerlog/LOAD is CRITICAL と検索して過去の発報時の値を確認
→すべてload average1分の閾値で検知している
1分の load average が30~39：7件中6件
1分の load average が40超：7件中1件
5/1 CRITICAL - load average: 33.39, 20.92, 10.58
5/16 CRITICAL - load average: 31.59, 21.45, 10.37
6/9 CRITICAL - load average: 35.65, 25.68, 14.71
7/11 CRITICAL - load average: 33.54, 25.46, 13.04
7/13 CRITICAL - load average: 41.33, 27.45, 14.60
7/14 CRITICAL - load average: 32.93, 27.20, 15.15
7/16 CRITICAL - load average: 32.67, 22.34, 12.16
過去の発砲時の値と、LOADが上がっていることで現状支障は出ていなさそうとのことから
load average1分の監視設定を以下に変更しようと思っています。
define service{
        use                             gen-service
        host_name                       nfs-partnerlog
        service_description             LOAD
        check_command                   check_nrpe_load!30,40,80!40,60,90
        }
お手数ですが、問題ないかご確認をお願いいたします。
































