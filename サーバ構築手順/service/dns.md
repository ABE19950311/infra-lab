■ 前提条件
・OS
[root@c22383d8a0fb /]# cat /etc/redhat-release
AlmaLinux release 8.10 (Cerulean Leopard)
・epel-releaseインストール済み
・ミドルウェアインストール時にインターネットへの経路が存在していること
・ansible未対応


■ 作業手順

0. host名変更
```````````````````````````````
// mysqlrouterサーバ(primary,secondary)
# hostnamectl set-hostname ホスト名
# hostname
```````````````````````````````

1. named-chroot-setup、named-chrootインストール
※先にnamed-chrootを起動すること
``````````````````````````````````````
# dnf install -y bind-chroot
# systemctl start named-chroot-setup
# systemctl status named-chroot-setup
# systemctl enable named-chroot-setup
⇒/var/named配下が作成される
# systemctl start named-chroot
# systemctl status named-chroot
# systemctl enable named-chroot
``````````````````````````````````````

2. named.conf修正
``````````````````````````````````````
# chown root:named /var/named/chroot/etc/named.conf
# vi /var/named/chroot/etc/named.conf
※forward only,forwareders入れてる理由
https://blue-red.ddo.jp/~ao/wiki/wiki.cgi?page=DNS%A5%B5%A1%BC%A5%D0%A1%BC%A4%CE%C0%DF%C4%EA
-----------以下内容で修正する----------
options {
        #listen-on port 53 { 127.0.0.1; };
        listen-on-v6 port 53 { ::1; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        secroots-file   "/var/named/data/named.secroots";
        recursing-file  "/var/named/data/named.recursing";
        allow-query     {
                localhost;
                172.28.0.0/16;
        };

        /*
         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
         - If you are building a RECURSIVE (caching) DNS server, you need to enable
           recursion.
         - If your recursive DNS server has a public IP address, you MUST enable access
           control to limit queries to your legitimate users. Failing to do so will
           cause your server to become part of large scale DNS amplification
           attacks. Implementing BCP38 within your network would greatly
           reduce such attack surface
        */
        recursion yes;

        dnssec-enable yes;
        dnssec-validation no;

        forward only;
        forwarders { 172.28.0.2; };

        managed-keys-directory "/var/named/dynamic";

        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";

        /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
        include "/etc/crypto-policies/back-ends/bind.config";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
        type hint;
        file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";
include "/etc/record.conf";
``````````````````````````````````````

3. test用record作成
``````````````````````````````````````
# vi /var/named/chroot/etc/record.conf
-----------以下を追記-----------
zone "hoge.co.jp"  IN {
        type master;
        file "zone/hoge.co.jp.zone";
};

# chown root:named /var/named/chroot/etc/record.conf
``````````````````````````````````````

4. ゾーンファイル作成
``````````````````````````````````````
# mkdir -p /var/named/zone
# vi /var/named/zone/hoge.co.jp.zone
-----------以下を追記-----------
$TTL 1D
@               IN SOA  ns.hoge.co.jp. root.hoge.co.jp. (
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
                IN NS   ns.hoge.co.jp.
@               IN A    14.18.9.11
ns              IN A    172.28.10.13(dnsサーバIP)

# chown -R root:named /var/named/zone
``````````````````````````````````````

5. resolv.conf修正とnamed-chroot再起動
※他ローカルサーバのresolv.confも修正する
``````````````````````````````````````
# vi /etc/resolv.conf
----------以下内容で修正--------------
# Generated by Docker Engine.
# This file can be edited; Docker Engine will not make further changes once it
# has been modified.

nameserver 172.28.10.13(dnsサーバIP)
#nameserver 127.0.0.11
#search sj.estore.co.jp mshome.net
#options ndots:0

# Based on host file: '/etc/resolv.conf' (internal resolver)
# ExtServers: [host(10.255.255.254)]
# Overrides: []
# Option ndots from: internal

# systemctl restart named-chroot
``````````````````````````````````````
